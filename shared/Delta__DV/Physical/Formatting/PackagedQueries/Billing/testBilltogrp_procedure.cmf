<?xml version="1.1" encoding="UTF-8"?>
<!-- salt:cde82315-e936-41f1-90c6-32daeeda6afd -->
<metadata name="testBilltogrp" path="/shared/Delta_DV/Physical/Formatting/PackagedQueries/Billing/testBilltogrp" type="PROCEDURE" subtype="EXTERNAL_SQL_PROCEDURE" changeToken="0">
  <parameters>
    <parameter name="result" direction="OUT" nullable="true">
      <datatype type="TABLE" refId="256">
        <element name="INVOICENUMBER">
          <datatype name="VARCHAR" extendedName="VARCHAR2(30)" subType="DATASOURCE_TYPE" type="STRING" maxLength="30"/>
        </element>
        <element name="PAYMENTNUMBER">
          <datatype name="VARCHAR" extendedName="VARCHAR2(30)" subType="DATASOURCE_TYPE" type="STRING" maxLength="30"/>
        </element>
        <element name="INVOICEDATE">
          <datatype name="TIMESTAMP" extendedName="DATE" subType="DATASOURCE_TYPE" type="DATETIME"/>
        </element>
        <element name="BILLTODIV">
          <datatype name="VARCHAR" extendedName="VARCHAR2(40)" subType="DATASOURCE_TYPE" type="STRING" maxLength="40"/>
        </element>
        <element name="BILLTOACCOUNT">
          <datatype name="VARCHAR" extendedName="VARCHAR2(30)" subType="DATASOURCE_TYPE" type="STRING" maxLength="30"/>
        </element>
        <element name="BILLTOID">
          <datatype name="VARCHAR" extendedName="VARCHAR2(45)" subType="DATASOURCE_TYPE" type="STRING" maxLength="45"/>
        </element>
        <element name="PAYMENTINITIATEDATE">
          <datatype name="TIMESTAMP" extendedName="DATE" subType="DATASOURCE_TYPE" type="DATETIME"/>
        </element>
        <element name="PAYMENTDATE">
          <datatype name="TIMESTAMP" extendedName="DATE" subType="DATASOURCE_TYPE" type="DATETIME"/>
        </element>
        <element name="PAYMENTTYPE">
          <datatype name="VARCHAR" extendedName="VARCHAR2(150)" subType="DATASOURCE_TYPE" type="STRING" maxLength="150"/>
        </element>
        <element name="PAYMENTSTATUS">
          <datatype name="VARCHAR" extendedName="VARCHAR2(10)" subType="DATASOURCE_TYPE" type="STRING" maxLength="10"/>
        </element>
        <element name="ORIGINALINVOICEAMOUNT">
          <datatype name="DECIMAL" extendedName="NUMBER(38,0)" subType="DATASOURCE_TYPE" type="DECIMAL" maxDigits="38" maxFractionalDigits="0"/>
        </element>
        <element name="AMOUNTAPPLIED">
          <datatype name="DECIMAL" extendedName="NUMBER(38,0)" subType="DATASOURCE_TYPE" type="DECIMAL" maxDigits="38" maxFractionalDigits="0"/>
        </element>
        <element name="OUTSTANDBALANCE">
          <datatype name="DECIMAL" extendedName="NUMBER(38,0)" subType="DATASOURCE_TYPE" type="DECIMAL" maxDigits="38" maxFractionalDigits="0"/>
        </element>
        <element name="ADJUSTMENT">
          <datatype name="DECIMAL" extendedName="NUMBER(38,0)" subType="DATASOURCE_TYPE" type="DECIMAL" maxDigits="38" maxFractionalDigits="0"/>
        </element>
        <element name="CREDITMEMO">
          <datatype name="DECIMAL" extendedName="NUMBER(38,0)" subType="DATASOURCE_TYPE" type="DECIMAL" maxDigits="38" maxFractionalDigits="0"/>
        </element>
        <element name="PAYMENTAMOUNT">
          <datatype name="DECIMAL" extendedName="NUMBER(38,0)" subType="DATASOURCE_TYPE" type="DECIMAL" maxDigits="38" maxFractionalDigits="0"/>
        </element>
        <element name="PAYMENTTOTAL">
          <datatype name="DECIMAL" extendedName="NUMBER(38,0)" subType="DATASOURCE_TYPE" type="DECIMAL" maxDigits="38" maxFractionalDigits="0"/>
        </element>
        <element name="BRAND">
          <datatype name="VARCHAR" extendedName="VARCHAR2(8)" subType="DATASOURCE_TYPE" type="STRING" maxLength="8"/>
        </element>
        <element name="RK">
          <datatype name="DECIMAL" extendedName="NUMBER(38,0)" subType="DATASOURCE_TYPE" type="DECIMAL" maxDigits="38" maxFractionalDigits="0"/>
        </element>
        <element name="TOTALNUMBEROFROWS">
          <datatype name="DECIMAL" extendedName="NUMBER(38,0)" subType="DATASOURCE_TYPE" type="DECIMAL" maxDigits="38" maxFractionalDigits="0"/>
        </element>
      </datatype>
    </parameter>
  </parameters>
  <security>
    <owner user="nobody" domain="composite"/>
  </security>
  <dependency target="/shared/Delta_DV/Physical/Metadata/DataSources/efs" type="DATA_SOURCE">
    <datatype name="Tree" type="TREE" refId="257"></datatype>
  </dependency>
  <attribute name="SQL" type="STRING">select * from
(select  a.* ,row_number() over (order by
    invoicenumber asc )rk,
COUNT(*) OVER () totalnumberofrows
from(
SELECT /*+ parallel(16) */
    arc.cons_billing_number       invoiceNumber, 
               acr.receipt_number
    paymentNumber, 
               Max(rct.trx_date)             invoiceDate,
    hcsu.location                 billToDiv, 
               hca.account_number
    billToAccount, 
               hcsu.location ||&apos;00000&apos; billToID, 
               ara.apply_date
    paymentInitiateDate, 
               acr.receipt_date              paymentDate,  
      case
    when arm.attribute2=&apos;Checks&apos; then &apos;Check&apos; When arm.attribute2=&apos;Manual Entry&apos; then &apos;Offline&apos;
    when arm.attribute2=&apos;Credit Card&apos; then &apos;CreditCard&apos; when arm.attribute2=&apos;Other&apos; then &apos;Offline&apos;
    when arm.attribute2=&apos;Online ACH&apos; then &apos;Online&apos; else arm.attribute2 end paymentType,
    Case when l_state.meaning=&apos;REVERSED&apos; then &apos;Rejected&apos; else &apos;Successful&apos; end   paymentStatus,
    Sum(arp.amount_due_original)  originalInvoiceAmount, 
               Sum(ara.amount_applied)
    amountApplied, 
               Sum(arp.amount_due_remaining) outstandBalance,
    CASE WHEN Sum(adj.amount) IS NULL THEN 0.0 
                 ELSE Sum(adj.amount) END AS
    adjustment, 
               CASE WHEN Sum(aracm.amount_applied) IS NULL THEN 0.0
    ELSE Sum(aracm.amount_applied) END AS creditMemo, 
               acr.amount
    paymentAmount, 
               acr.amount                    paymentTotal,
case when
    hcsu.ATTRIBUTE8||hcsu.ATTRIBUTE3 in(&apos;DNTGRAGXDDICDIC&apos;,&apos;DNTGRAGXDDICDICNE&apos;) then &apos;DDINS&apos;
    when hcsu.ATTRIBUTE3 in(&apos;DIC&apos;,&apos;DICNE&apos;) then &apos;DENTEGRA&apos; else &apos;DDINS&apos; end BRAND
    FROM   apps.ar_receivable_applications_all ara 
               INNER JOIN
    apps.ar_cash_receipts_all acr 
               ON acr.cash_receipt_id = ara.cash_receipt_id
    AND acr.org_id = ara.org_id 
               AND ara.application_type = &apos;CASH&apos;
    AND ara.display = &apos;Y&apos; 
               AND acr.receipt_number =
    COALESCE(NULLIF(&apos;NULL&apos;,&apos;NULL&apos;),acr.receipt_number)
               AND acr.Amount &lt;=
    COALESCE(NULL,acr.Amount) 
               AND acr.Amount &gt;= COALESCE(NULL,acr.Amount) 
    AND
    acr.Amount = COALESCE(NULL,acr.Amount)
               AND acr.receipt_date  &gt;=
    COALESCE(NULL,acr.receipt_date ) 
    AND acr.receipt_date  &lt;= COALESCE(NULL,acr.receipt_date )
    INNER JOIN apps.ra_customer_trx_all rct 
               ON ara.applied_customer_trx_id =
    rct.customer_trx_id
               INNER JOIN apps.hz_cust_accounts hca 
               ON
    hca.cust_account_id = rct.bill_to_customer_id 
               INNER JOIN apps.ar_receipt_methods
    arm 
               ON acr.receipt_method_id = arm.receipt_method_id 
               AND
    (UPPER(arm.attribute2) IN (&apos;x&apos;) or q&apos;[(&apos;x&apos;)]&apos; =q&apos;[(&apos;x&apos;)]&apos;)
               INNER JOIN
    apps.ar_cons_inv_trx_all art 
               ON rct.customer_trx_id = art.customer_trx_id
    INNER JOIN apps.ar_cons_inv_all arc 
               ON art.cons_inv_id = arc.cons_inv_id
    AND (arc.cons_billing_number != &apos;NULL&apos; and arc.cons_billing_number is not NULL
    AND arc.cons_billing_number = COALESCE(NULLIF(&apos;NULL&apos;,&apos;NULL&apos;),arc.cons_billing_number))
    INNER JOIN apps.hz_cust_acct_sites_all hcas 
               ON hca.cust_account_id =
    hcas.cust_account_id 
               INNER JOIN apps.hz_cust_site_uses_all hcsu
    ON hcas.cust_acct_site_id = hcsu.cust_acct_site_id 
                 AND hcsu.site_use_id =
    rct.bill_to_site_use_id  and hcsu.location like &apos;R%&apos;
     AND (hcsu.location ||&apos;00000&apos; IN
    (&apos;R10133600000&apos;) or q&apos;[(&apos;R10133600000&apos;)]&apos; =q&apos;[(&apos;x&apos;)]&apos;) 
               INNER JOIN
    apps.ar_payment_schedules_all arp 
                       ON arp.customer_trx_id =
    rct.customer_trx_id 
               INNER JOIN apps.hz_cust_site_uses_all hcsuship
    ON hcsuship.site_use_id = rct.ship_to_site_use_id 
               INNER JOIN
    apps.hz_cust_accounts hcaship 
                       ON hcaship.cust_account_id =
    rct.ship_to_customer_id 
               INNER JOIN apps.hz_cust_acct_sites_all hcasship
    ON hcaship.cust_account_id = hcasship.cust_account_id 
                          AND
    hcasship.cust_acct_site_id = 
                              hcsuship.cust_acct_site_id 
INNER
    JOIN  apps.ar_cash_receipt_history_all crh_current ON 
    crh_current.cash_receipt_id =
    acr.cash_receipt_id
    AND   crh_current.org_id = acr.org_id
    AND
    crh_current.current_record_flag = &apos;Y&apos;
    AND crh_current.status IN
    (&apos;REVERSED&apos;,&apos;CLEARED&apos;,&apos;REMITTED&apos;)    
INNER JOIN apps.ar_lookups l_state ON
    l_state.lookup_code = crh_current.status AND
    l_state.lookup_type =
    &apos;RECEIPT_CREATION_STATUS&apos;
 AND (UPPER(l_state.meaning) IN (&apos;x&apos;) or q&apos;[(&apos;x&apos;)]&apos; =q&apos;[(&apos;x&apos;)]&apos;)
LEFT
    OUTER JOIN apps.ar_adjustments_all adj 
    ON adj.customer_trx_id = rct.customer_trx_id 
LEFT
    OUTER JOIN apps.ar_receivable_applications_all aracm 
    ON aracm.applied_customer_trx_id =
    rct.customer_trx_id 
    AND aracm.display = &apos;Y&apos; AND aracm.application_type = &apos;CM&apos; 
 GROUP  BY
    acr.receipt_number,acr.receipt_date,arm.attribute2,acr.amount,
    hcsu.location,hca.account_number,arc.cons_billing_number,ara.apply_date,
l_state.meaning,hcsu.ATTRIBUTE8,hcsu.ATTRIBUTE3
)a
    WHERE
invoiceDate &gt;= COALESCE(NULL,invoiceDate) AND
invoiceDate &lt;= COALESCE(NULL,invoiceDate)
    AND
amountApplied &lt;= COALESCE(NULL,amountApplied) AND
amountApplied &gt;=
    COALESCE(NULL,amountApplied) AND
originalInvoiceAmount &lt;= COALESCE(NULL,originalInvoiceAmount)
    AND
originalInvoiceAmount &gt;= COALESCE(NULL,originalInvoiceAmount) AND
outstandBalance &lt;=
    COALESCE(NULL,outstandBalance) AND
outstandBalance &gt;= COALESCE(NULL,outstandBalance)
    AND
adjustment &lt;= COALESCE(NULL,adjustment) AND
adjustment &gt;= COALESCE(NULL,adjustment)
    AND
creditMemo &lt;= COALESCE(NULL,creditMemo) AND
creditMemo &gt;= COALESCE(NULL,creditMemo)
    AND
BRAND = COALESCE(NULLIF(&apos;DDINS&apos;,&apos;NULL&apos;),BRAND)
) where rk BETWEEN (1 - 1) * 100 + 1 AND 1 * 100</attribute>
  <attribute name="creationDate" type="LONG">1607114865797</attribute>
  <attribute name="creatorUserDomain" type="STRING">dev</attribute>
  <attribute name="creatorUserId" type="INTEGER">3100101</attribute>
  <attribute name="creatorUserName" type="STRING">dca89313</attribute>
  <attribute name="isSingleSelect" type="STRING">false</attribute>
  <attribute name="lastModifiedDate" type="LONG">1609896176534</attribute>
  <attribute name="lastModifiedUserDomain" type="STRING">composite</attribute>
  <attribute name="lastModifiedUserId" type="INTEGER">3100101</attribute>
  <attribute name="lastModifiedUserName" type="STRING">admin</attribute>
  <attribute name="passThroughSource" type="STRING">/shared/Delta_DV/Physical/Metadata/DataSources/efs</attribute>
  <attribute name="resourceModifiedDateOnSourceCISSite" type="LONG">1607114865797</attribute>
</metadata>