<?xml version="1.1" encoding="UTF-8"?>
<!-- salt:cde82315-e936-41f1-90c6-32daeeda6afd -->
<metadata name="pkgPl_DivisionCodeAudit" path="/shared/Delta_DV/Physical/Formatting/PackagedQueries/Group/pkgPl_DivisionCodeAudit" type="PROCEDURE" subtype="EXTERNAL_SQL_PROCEDURE" changeToken="0">
  <parameters>
    <parameter name="inGroupID" direction="IN" nullable="true">
      <datatype name="VARCHAR" type="STRING" maxLength="12"/>
    </parameter>
    <parameter name="inDivisionID" direction="IN" nullable="true">
      <datatype name="VARCHAR" type="STRING" maxLength="12"/>
    </parameter>
    <parameter name="inAsOfDate" direction="IN" nullable="true">
      <datatype name="DATE" type="DATE"/>
    </parameter>
    <parameter name="result" direction="OUT" nullable="true">
      <datatype name="CURSOR" type="TABLE" refId="256">
        <element name="GroupID">
          <datatype name="VARCHAR" type="STRING" maxLength="255"/>
        </element>
        <element name="DivisionID">
          <datatype name="VARCHAR" type="STRING" maxLength="255"/>
        </element>
        <element name="CodeAuditCD">
          <datatype name="VARCHAR" type="STRING" maxLength="255"/>
        </element>
        <element name="EffDate">
          <datatype name="DATE" type="DATE"/>
        </element>
        <element name="EndDate">
          <datatype name="DATE" type="DATE"/>
        </element>
        <element name="PrecedenceRnk">
          <datatype name="TINYINT" type="INTEGER" minValue="-128" maxValue="127"/>
        </element>
      </datatype>
    </parameter>
  </parameters>
  <security>
    <owner user="nobody" domain="composite"/>
  </security>
  <dependency target="/shared/Delta_DV/Physical/Metadata/DataSources/MTV" type="DATA_SOURCE">
    <datatype name="Tree" type="TREE" refId="257"></datatype>
  </dependency>
  <attribute name="SQL" type="STRING">       SELECT A.*
       FROM  (SELECT DISTINCT BusinessLevel.EMPGRP_LEVEL_1_ID, BusinessLevel.EMPGRP_LEVEL_2_ID, 
                     CASE
                        WHEN CodeAudit_1.ROWID IS NOT NULL THEN CodeAudit_1.CODING_ADT_TBLE_CD
                        WHEN CodeAudit_2.ROWID IS NOT NULL THEN CodeAudit_2.CODING_ADT_TBLE_CD
                        WHEN CodeAudit_3.ROWID IS NOT NULL THEN CodeAudit_3.CODING_ADT_TBLE_CD
                        WHEN CodeAudit_4.ROWID IS NOT NULL THEN CodeAudit_4.CODING_ADT_TBLE_CD
                        --WHEN CodeAudit_5.ROWID IS NOT NULL THEN CodeAudit_5.CODING_ADT_TBLE_CD
                        ELSE NULL
                     END CODING_ADT_TBLE_CD,
                     CASE
                        WHEN CodeAudit_1.ROWID IS NOT NULL THEN GREATEST(CodeAudit_1.EFFECTIVE_DATE, BusinessLevel.EFFECTIVE_DATE, BenefitPackage.EFFECTIVE_DATE)
                        WHEN CodeAudit_2.ROWID IS NOT NULL THEN GREATEST(CodeAudit_2.EFFECTIVE_DATE, BusinessLevel.EFFECTIVE_DATE)
                        WHEN CodeAudit_3.ROWID IS NOT NULL THEN GREATEST(CodeAudit_3.EFFECTIVE_DATE, BusinessLevel.EFFECTIVE_DATE)
                        WHEN CodeAudit_4.ROWID IS NOT NULL THEN GREATEST(CodeAudit_4.EFFECTIVE_DATE, BusinessLevel.EFFECTIVE_DATE)
                        --WHEN CodeAudit_5.ROWID IS NOT NULL THEN CodeAudit_5.EFFECTIVE_DATE
                        ELSE NULL
                     END EFFECTIVE_DATE,
                     CASE
                        WHEN CodeAudit_1.ROWID IS NOT NULL THEN LEAST(CodeAudit_1.END_DATE, BusinessLevel.END_DATE)
                        WHEN CodeAudit_2.ROWID IS NOT NULL THEN LEAST(CodeAudit_2.END_DATE, BusinessLevel.END_DATE)
                        WHEN CodeAudit_3.ROWID IS NOT NULL THEN LEAST(CodeAudit_3.END_DATE, BusinessLevel.END_DATE)
                        WHEN CodeAudit_4.ROWID IS NOT NULL THEN LEAST(CodeAudit_4.END_DATE, BusinessLevel.END_DATE)
                        --WHEN CodeAudit_5.ROWID IS NOT NULL THEN CodeAudit_5.END_DATE
                        ELSE NULL
                     END END_DATE,
                     CASE
                        WHEN CodeAudit_1.ROWID IS NOT NULL THEN 1
                        WHEN CodeAudit_2.ROWID IS NOT NULL THEN 2
                        WHEN CodeAudit_3.ROWID IS NOT NULL THEN 3
                        WHEN CodeAudit_4.ROWID IS NOT NULL THEN 4
                        --WHEN CodeAudit_5.ROWID IS NOT NULL THEN 5
                        ELSE NULL
                     END RNK
              FROM   MVPPPRD.EMPGRP_LVL_BUS_LVL BusinessLevel
              JOIN   MVPPPRD.EMPGRP_LVX_BEN_PKG BenefitPackage
              ON     BusinessLevel.EMPGRP_LEVEL_1_ID = BenefitPackage.EMPGRP_LEVEL_1_ID
              AND    BusinessLevel.EMPGRP_LEVEL_2_ID = BenefitPackage.EMPGRP_LEVEL_2_ID
              LEFT OUTER JOIN MVPPPRD.RULE_ASSIGNMENT CodeAudit_1
              ON     CodeAudit_1.BUS_LEVEL_7_ID = BusinessLevel.BUS_LEVEL_7_ID
              AND    CodeAudit_1.BUS_LEVEL_6_ID = BusinessLevel.BUS_LEVEL_6_ID
              AND    CodeAudit_1.BUS_LEVEL_5_ID = BusinessLevel.BUS_LEVEL_5_ID
              AND    CodeAudit_1.BUS_LEVEL_4_ID = BusinessLevel.BUS_LEVEL_4_ID
              AND    CodeAudit_1.EMPGRP_LEVEL_1_ID = BusinessLevel.EMPGRP_LEVEL_1_ID
              AND    CodeAudit_1.EMPGRP_LEVEL_2_ID = BusinessLevel.EMPGRP_LEVEL_2_ID
              AND    CodeAudit_1.BENEFIT_PACKAGE_ID = BenefitPackage.BENEFIT_PACKAGE_ID
              AND    {2} BETWEEN CodeAudit_1.EFFECTIVE_DATE AND CodeAudit_1.END_DATE
              AND    CodeAudit_1.CODING_ADT_TBLE_CD &lt;&gt; RPAD(&apos; &apos;, 5, &apos; &apos;)
              AND    CodeAudit_1.VOID_FLAG = &apos;N&apos;
              LEFT OUTER JOIN MVPPPRD.RULE_ASSIGNMENT CodeAudit_2
              ON     CodeAudit_2.BUS_LEVEL_7_ID = BusinessLevel.BUS_LEVEL_7_ID
              AND    CodeAudit_2.BUS_LEVEL_6_ID = BusinessLevel.BUS_LEVEL_6_ID
              AND    CodeAudit_2.BUS_LEVEL_5_ID = BusinessLevel.BUS_LEVEL_5_ID
              AND    CodeAudit_2.BUS_LEVEL_4_ID = BusinessLevel.BUS_LEVEL_4_ID
              AND    CodeAudit_2.EMPGRP_LEVEL_1_ID = BusinessLevel.EMPGRP_LEVEL_1_ID
              AND    CodeAudit_2.EMPGRP_LEVEL_2_ID = BusinessLevel.EMPGRP_LEVEL_2_ID
              AND    {2} BETWEEN CodeAudit_2.EFFECTIVE_DATE AND CodeAudit_2.END_DATE
              AND    CodeAudit_2.CODING_ADT_TBLE_CD &lt;&gt; RPAD(&apos; &apos;, 5, &apos; &apos;)
              AND    CodeAudit_2.EMPGRP_LEVEL_1_ID &lt;&gt; RPAD(&apos; &apos;, 12, &apos; &apos;) AND CodeAudit_2.EMPGRP_LEVEL_2_ID &lt;&gt; RPAD(&apos; &apos;, 12, &apos; &apos;) AND CodeAudit_2.BENEFIT_PACKAGE_ID = RPAD(&apos; &apos;, 8, &apos; &apos;)
              AND    CodeAudit_2.VOID_FLAG = &apos;N&apos;
              JOIN   MVPPPRD.RULE_ASSIGNMENT CodeAudit_3
              ON     CodeAudit_3.BUS_LEVEL_7_ID = BusinessLevel.BUS_LEVEL_7_ID
              AND    CodeAudit_3.BUS_LEVEL_6_ID = BusinessLevel.BUS_LEVEL_6_ID
              AND    CodeAudit_3.BUS_LEVEL_5_ID = BusinessLevel.BUS_LEVEL_5_ID
              AND    CodeAudit_3.BUS_LEVEL_4_ID = BusinessLevel.BUS_LEVEL_4_ID
              AND    CodeAudit_3.EMPGRP_LEVEL_1_ID = BusinessLevel.EMPGRP_LEVEL_1_ID
              AND    {2} BETWEEN CodeAudit_3.EFFECTIVE_DATE AND CodeAudit_3.END_DATE
              AND    CodeAudit_3.CODING_ADT_TBLE_CD &lt;&gt; RPAD(&apos; &apos;, 5, &apos; &apos;)
              AND    CodeAudit_3.EMPGRP_LEVEL_1_ID &lt;&gt; RPAD(&apos; &apos;, 12, &apos; &apos;) AND CodeAudit_3.EMPGRP_LEVEL_2_ID = RPAD(&apos; &apos;, 12, &apos; &apos;) AND CodeAudit_3.BENEFIT_PACKAGE_ID = RPAD(&apos; &apos;, 8, &apos; &apos;)
              AND    CodeAudit_3.VOID_FLAG = &apos;N&apos;
              LEFT OUTER JOIN MVPPPRD.RULE_ASSIGNMENT CodeAudit_4
              ON     CodeAudit_4.BUS_LEVEL_7_ID = BusinessLevel.BUS_LEVEL_7_ID
              AND    CodeAudit_4.BUS_LEVEL_6_ID = BusinessLevel.BUS_LEVEL_6_ID
              AND    CodeAudit_4.BUS_LEVEL_5_ID = BusinessLevel.BUS_LEVEL_5_ID
              AND    CodeAudit_4.BUS_LEVEL_4_ID = BusinessLevel.BUS_LEVEL_4_ID
              AND    {2} BETWEEN CodeAudit_4.EFFECTIVE_DATE AND CodeAudit_4.END_DATE
              AND    CodeAudit_4.CODING_ADT_TBLE_CD &lt;&gt; RPAD(&apos; &apos;, 5, &apos; &apos;)
              AND    CodeAudit_4.EMPGRP_LEVEL_1_ID = RPAD(&apos; &apos;, 12, &apos; &apos;) AND CodeAudit_4.EMPGRP_LEVEL_2_ID = RPAD(&apos; &apos;, 12, &apos; &apos;) AND CodeAudit_4.BUS_LEVEL_7_ID &lt;&gt; RPAD(&apos; &apos;, 12, &apos; &apos;)
              AND    CodeAudit_4.VOID_FLAG = &apos;N&apos;
              /*LEFT OUTER JOIN MVPPPRD.RULE_ASSIGNMENT CodeAudit_5
              ON     CodeAudit_5.BUS_LEVEL_4_ID = BusinessLevel.BUS_LEVEL_4_ID 
              AND    {2} BETWEEN CodeAudit_5.EFFECTIVE_DATE AND CodeAudit_5.END_DATE
              AND    CodeAudit_5.CODING_ADT_TBLE_CD &lt;&gt; RPAD(&apos; &apos;, 5, &apos; &apos;)
              AND    CodeAudit_5.BUS_LEVEL_7_ID = RPAD(&apos; &apos;, 12, &apos; &apos;)
              AND    CodeAudit_5.VOID_FLAG = &apos;N&apos;*/
              WHERE  BusinessLevel.EMPGRP_LEVEL_1_ID = &apos;{0}&apos; AND BusinessLevel.EMPGRP_LEVEL_2_ID = &apos;{1}&apos;
              AND    {2} BETWEEN BusinessLevel.EFFECTIVE_DATE AND BusinessLevel.END_DATE
              AND    BusinessLevel.EMP_GRP_LEVEL = &apos;2&apos;
              AND    BusinessLevel.BUS_LEVEL_5_ID &lt;&gt; &apos;DSD         &apos;
              AND    BusinessLevel.AUDIT_FLAG = &apos;N&apos; AND BusinessLevel.VOID_FLAG = &apos;N&apos;
              AND    BenefitPackage.EMPGRP_LEVEL_1_ID = &apos;{0}&apos; AND BenefitPackage.EMPGRP_LEVEL_2_ID = &apos;{1}&apos;
              AND    {2} BETWEEN BenefitPackage.EFFECTIVE_DATE AND BenefitPackage.END_DATE
              AND    BenefitPackage.AUDIT_FLAG = &apos;N&apos; AND BenefitPackage.VOID_FLAG = &apos;N&apos;
             ) A
       WHERE  CODING_ADT_TBLE_CD IS NOT NULL    
</attribute>
  <attribute name="creationDate" type="LONG">1612576893062</attribute>
  <attribute name="creatorUserDomain" type="STRING">dev</attribute>
  <attribute name="creatorUserId" type="INTEGER">2810101</attribute>
  <attribute name="creatorUserName" type="STRING">dca31940</attribute>
  <attribute name="isSingleSelect" type="STRING">false</attribute>
  <attribute name="lastModifiedDate" type="LONG">1612831907608</attribute>
  <attribute name="lastModifiedUserDomain" type="STRING">dev</attribute>
  <attribute name="lastModifiedUserId" type="INTEGER">2810101</attribute>
  <attribute name="lastModifiedUserName" type="STRING">dca31940</attribute>
  <attribute name="passThroughSource" type="STRING">/shared/Delta_DV/Physical/Metadata/DataSources/MTV</attribute>
  <attribute name="resourceModifiedDateOnSourceCISSite" type="LONG">1612576893062</attribute>
</metadata>