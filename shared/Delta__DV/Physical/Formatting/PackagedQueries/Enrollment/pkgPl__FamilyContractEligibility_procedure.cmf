<?xml version="1.1" encoding="UTF-8"?>
<!-- salt:cde82315-e936-41f1-90c6-32daeeda6afd -->
<metadata name="pkgPl_FamilyContractEligibility" path="/shared/Delta_DV/Physical/Formatting/PackagedQueries/Enrollment/pkgPl_FamilyContractEligibility" type="PROCEDURE" subtype="EXTERNAL_SQL_PROCEDURE" changeToken="0">
  <parameters>
    <parameter name="inContractID" direction="IN" nullable="true">
      <datatype name="VARCHAR" type="STRING" maxLength="25"/>
    </parameter>
    <parameter name="result" direction="OUT" nullable="true">
      <datatype name="CURSOR" type="TABLE" refId="256">
        <element name="EnrolleeID">
          <datatype name="VARCHAR" type="STRING" maxLength="27"/>
        </element>
        <element name="ContractID">
          <datatype name="VARCHAR" type="STRING" maxLength="25"/>
        </element>
        <element name="MemberID">
          <datatype name="VARCHAR" type="STRING" maxLength="2"/>
        </element>
        <element name="ContractEffDate">
          <datatype name="DATE" type="DATE"/>
        </element>
        <element name="ContractEndDate">
          <datatype name="DATE" type="DATE"/>
        </element>
        <element name="ContractTermReasonCD">
          <datatype name="VARCHAR" type="STRING" maxLength="4"/>
        </element>
        <element name="ContractTermReasonDESC">
          <datatype name="VARCHAR" type="STRING" maxLength="100"/>
        </element>
        <element name="EligEffDate">
          <datatype name="DATE" type="DATE"/>
        </element>
        <element name="EligEndDate">
          <datatype name="DATE" type="DATE"/>
        </element>
        <element name="EligTermReasonCD">
          <datatype name="VARCHAR" type="STRING" maxLength="4"/>
        </element>
        <element name="EligTermReasonDESC">
          <datatype name="VARCHAR" type="STRING" maxLength="100"/>
        </element>
        <element name="ContractTypeCD">
          <datatype name="VARCHAR" type="STRING" maxLength="4"/>
        </element>
        <element name="ContractTypeDESC">
          <datatype name="VARCHAR" type="STRING" maxLength="100"/>
        </element>
        <element name="MBRClassCD">
          <datatype name="VARCHAR" type="STRING" maxLength="4"/>
        </element>
        <element name="MBRClassDESC">
          <datatype name="VARCHAR" type="STRING" maxLength="100"/>
        </element>
        <element name="GroupID">
          <datatype name="VARCHAR" type="STRING" maxLength="12"/>
        </element>
        <element name="DivisionID">
          <datatype name="VARCHAR" type="STRING" maxLength="12"/>
        </element>
        <element name="GroupDivision">
          <datatype name="VARCHAR" type="STRING" maxLength="24"/>
        </element>
        <element name="BenefitPkgID">
          <datatype name="VARCHAR" type="STRING" maxLength="8"/>
        </element>
        <element name="GroupType">
          <datatype name="VARCHAR" type="STRING" maxLength="12"/>
        </element>
        <element name="ContractHolder">
          <datatype name="VARCHAR" type="STRING" maxLength="12"/>
        </element>
        <element name="State">
          <datatype name="VARCHAR" type="STRING" maxLength="12"/>
        </element>
        <element name="Product">
          <datatype name="VARCHAR" type="STRING" maxLength="12"/>
        </element>
        <element name="ApplyWaitPeriodIND">
          <datatype name="VARCHAR" type="STRING" maxLength="5"/>
        </element>
      </datatype>
    </parameter>
  </parameters>
  <security>
    <owner user="nobody" domain="composite"/>
  </security>
  <dependency target="/shared/Delta_DV/Physical/Metadata/DataSources/MTV" type="DATA_SOURCE">
    <datatype name="Tree" type="TREE" refId="257"></datatype>
  </dependency>
  <attribute name="SQL" type="STRING">SELECT TRIM(A.CONTRACT_ID) || A.MEMBER_ID ENROLLEE_ID,
       TRIM(A.CONTRACT_ID), 
       A.MEMBER_ID,
       CTS.EFFECTIVE_DATE CONTRACT_EFF,
       CTS.END_DATE CONTRACT_END,
       TRIM(CTS.DISENROLL_RESN_CD) CONTRACT_TERM_REASON_CD,
       DS1.REPORT_DESC CONTRACT_TERM_REASON_DESC,
       A.EFFECTIVE_DATE ELIG_EFF,
       A.END_DATE ELIG_END,
       TRIM(A.DISENR_REASON_CD) ELIG_TERM_REASON_CD,
       DS2.REPORT_DESC ELIG_TERM_REASON_DESC,
       TRIM(CTS.CONTRACT_TYPE_CD),
       CY.REPORT_DESC CONTRACT_TYPE_DESC, 
       TRIM(A.CLASS_CODE) MEMBER_CLASS_CD,
       CL.REPORT_DESC MEMBER_CLASS_DESC,
       TRIM(CTS.EMPGRP_LVL_1_ID) GROUP_ID,
       TRIM(CTS.EMPGRP_LVL_2_ID) DIVISION_ID,
       TRIM(CTS.EMPGRP_LVL_1_ID) || &apos;/&apos; || TRIM(CTS.EMPGRP_LVL_2_ID) GROUP_DIVISION,
       A.BENEFIT_PKG_ID,
       TRIM(A.BUS_LEVEL_4_ID),
       TRIM(A.BUS_LEVEL_5_ID),
       TRIM(A.BUS_LEVEL_6_ID),
       TRIM(A.BUS_LEVEL_7_ID),
       DECODE(A.APPLY_WAIT_PD_FG, &apos;Y&apos;, &apos;true&apos;, &apos;false&apos;) APPLY_WAIT_PERIOD_IND
FROM  (SELECT ME.CONTRACT_ID, ME.MEMBER_ID, ME.EFFECTIVE_DATE, ME.END_DATE, ME.DISENR_REASON_CD, ME.CLASS_CODE,
              ME.BENEFIT_PKG_ID, 
              ME.BUS_LEVEL_4_ID,
              ME.BUS_LEVEL_5_ID,
              ME.BUS_LEVEL_6_ID,
              ME.BUS_LEVEL_7_ID,
              ME.APPLY_WAIT_PD_FG,
              RANK() OVER (PARTITION BY ME.CONTRACT_ID, ME.MEMBER_ID ORDER BY ME.END_DATE DESC) RNK
       FROM   MVPPPRD.MEMBER_ELIGIBILITY ME
       WHERE  ME.CONTRACT_ID = &apos;{0}&apos;
       AND    ME.AUDIT_FLAG = &apos;N&apos; AND ME.VOID_FLAG = &apos;N&apos;
      ) A
INNER JOIN MVPPPRD.COVERAGE_TYPE_SPAN CTS
ON     A.CONTRACT_ID = CTS.CONTRACT_ID 
LEFT OUTER JOIN MVPPPRD.CODE_VALUE CY
ON     CTS.CONTRACT_TYPE_CD = CY.CODE_VALUE_ID
AND    CY.FK_CODE_CATG_ID = &apos;CY&apos;
LEFT OUTER JOIN MVPPPRD.CODE_VALUE CL
ON     A.CLASS_CODE = CL.CODE_VALUE_ID
AND    CL.FK_CODE_CATG_ID = &apos;CL&apos;
LEFT OUTER JOIN MVPPPRD.CODE_VALUE DS1
ON     CTS.DISENROLL_RESN_CD = DS1.CODE_VALUE_ID
AND    DS1.FK_CODE_CATG_ID = &apos;DS&apos;
LEFT OUTER JOIN MVPPPRD.CODE_VALUE DS2
ON     A.DISENR_REASON_CD = DS2.CODE_VALUE_ID
AND    DS2.FK_CODE_CATG_ID = &apos;DS&apos;
WHERE  A.RNK = 1
AND    A.END_DATE BETWEEN CTS.EFFECTIVE_DATE AND CTS.END_DATE
AND    CTS.AUDIT_FLAG = &apos;N&apos; AND CTS.VOID_FLAG = &apos;N&apos;
ORDER BY 1</attribute>
  <attribute name="creationDate" type="LONG">1609961979771</attribute>
  <attribute name="creatorUserDomain" type="STRING">dev</attribute>
  <attribute name="creatorUserId" type="INTEGER">2810101</attribute>
  <attribute name="creatorUserName" type="STRING">dca31940</attribute>
  <attribute name="isSingleSelect" type="STRING">false</attribute>
  <attribute name="lastModifiedDate" type="LONG">1611274893514</attribute>
  <attribute name="lastModifiedUserDomain" type="STRING">dev</attribute>
  <attribute name="lastModifiedUserId" type="INTEGER">2810101</attribute>
  <attribute name="lastModifiedUserName" type="STRING">dca31940</attribute>
  <attribute name="passThroughSource" type="STRING">/shared/Delta_DV/Physical/Metadata/DataSources/MTV</attribute>
  <attribute name="resourceModifiedDateOnSourceCISSite" type="LONG">1609961979771</attribute>
</metadata>